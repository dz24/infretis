import numpy as np

def npperm(M):
    n = M.shape[0]
    d = np.ones(n)
    j =  0
    s = 1
    f = np.arange(n)
    v = M.sum(axis=0)
    p = np.prod(v)
    while (j < n-1):
        v -= 2*d[j]*M[j]
        d[j] = -d[j]
        s = -s
        prod = np.prod(v)
        p += s*prod
        f[0] = 0
        f[j] = f[j+1]
        f[j+1] = j+1
        j = f[0]
    return p/2**(n-1)

# weight = np.array([[1., 1., 1., 0.,],
#                    [1., 1., 1., 0.,],
#                    [1., 1., 1., 1.,],
#                    [1., 1., 1., 1.,]])

weight = np.array([[1., 1., 0., 0., 0.],
                   [1., 1., 1., 1., 0.],
                   [1., 1., 1., 0., 0.],
                   [1., 1., 1., 1., 1.],
                   [1., 1., 1., 1., 1.]])
frac = np.zeros(weight.shape)
print(weight)
print(' ')
for i in range(len(weight)):
    for j in range(len(weight)):
        row = list(range(len(weight)))
        col = list(range(len(weight)))
        row.pop(i)
        col.pop(j)
        weight[np.ix_(row, col)]
        frac[i, j] = weight[i,j]*npperm(weight[np.ix_(row, col)])/npperm(weight)


print(' ')
print(weight)
print(frac)
# print(weight[np.ix_([0,1,2,3], [0,1,2,3])])
# print(npperm(weight))


# weight2 = np.array([[5000000., 5000000., 11990735., 9000000.],
#                     [       1.,      1.,        0.,       0.],
#                     [       1.,      1.,        1.,       0.],
#                     [       1.,      1.,        1.,       1.]])

# weight2 = np.array([[10000., 10000., 9073., 9000.],
#                     [       1.,      1.,        0., 0.],
#                     [       1.,      1.,        1., 0.],
#                     [       1.,      1.,        1., 1.]])


# weight2 = np.array([[10352., 7896.,  7556.,  7406.,  7340.,  7304.,  6876.,  6166.,  5696.],
#                     [   11.,   11.,     0.,     0.,     0.,     0.,     0.,     0.,     0.],
#                     [   11.,   11.,    11.,     0.,     0.,     0.,     0.,     0.,     0.],
#                     [   11.,   11.,    11.,    11.,     0.,     0.,     0.,     0.,     0.],
#                     [   11.,   11.,    11.,    11.,    11.,     0.,     0.,     0.,     0.],
#                     [   11.,   11.,    11.,    11.,    11.,    11.,     0.,     0.,     0.],
#                     [   11.,   11.,    11.,    11.,    11.,    11.,    11.,     0.,     0.],
#                     [   11.,   11.,    11.,    11.,    11.,    11.,    11.,    11.,     0.],
#                     [   11.,   11.,    11.,    11.,    11.,    11.,    11.,    11.,    11.]])


# weight2 = np.array([[10352., 7896.,  7556.,  7406.,  7340.,  7304.,  6876.,  6166.,  5696., 0., 0., 0., 0.,  0.],
#                     [   11.,   11.,     0.,     0.,     0.,     0.,     0.,     0.,     0., 0., 0., 0., 0.,  0.],
#                     [   11.,   11.,    11.,     0.,     0.,     0.,     0.,     0.,     0., 0., 0., 0., 0.,  0.],
#                     [   11.,   11.,    11.,    11.,     0.,     0.,     0.,     0.,     0., 0., 0., 0., 0.,  0.],
#                     [   11.,   11.,    11.,    11.,    11.,     0.,     0.,     0.,     0., 0., 0., 0., 0.,  0.],
#                     [   11.,   11.,    11.,    11.,    11.,    11.,     0.,     0.,     0., 0., 0., 0., 0.,  0.],
#                     [   11.,   11.,    11.,    11.,    11.,    11.,    11.,     0.,     0., 0., 0., 0., 0.,  0.],
#                     [   11.,   11.,    11.,    11.,    11.,    11.,    11.,    11.,     0., 0., 0., 0., 0.,  0.],
#                     [   11.,   11.,    11.,    11.,    11.,    11.,    11.,    11.,    11., 0., 0., 0., 0.,  0.],
#                     [   11.,   11.,    11.,    11.,    11.,    11.,    11.,    11.,    11.,11., 0., 0., 0.,  0.],
#                     [   11.,   11.,    11.,    11.,    11.,    11.,    11.,    11.,    11., 0.,11., 0., 0.,  0.],
#                     [   11.,   11.,    11.,    11.,    11.,    11.,    11.,    11.,    11., 0., 0.,11., 0.,  0.],
#                     [   11.,   11.,    11.,    11.,    11.,    11.,    11.,    11.,    11., 0., 0., 0.,11.,  0.],
#                     [   11.,   11.,    11.,    11.,    11.,    11.,    11.,    11.,    11., 0., 0., 0., 0., 11.]])

# weight2 = np.array([[10352., 7896.,  7556.,  7406.,  7340.,  7304.,  6876.,  6166.,  5696., 0.],
#                     [   11.,   11.,     0.,     0.,     0.,     0.,     0.,     0.,     0., 0.],
#                     [   11.,   11.,    11.,     0.,     0.,     0.,     0.,     0.,     0., 0.],
#                     [   11.,   11.,    11.,    11.,     0.,     0.,     0.,     0.,     0., 0.],
#                     [   11.,   11.,    11.,    11.,    11.,     0.,     0.,     0.,     0., 0.],
#                     [   11.,   11.,    11.,    11.,    11.,    11.,     0.,     0.,     0., 0.],
#                     [   11.,   11.,    11.,    11.,    11.,    11.,    11.,     0.,     0., 0.],
#                     [   11.,   11.,    11.,    11.,    11.,    11.,    11.,    11.,     0., 0.],
#                     [   11.,   11.,    11.,    11.,    11.,    11.,    11.,    11.,    11., 0.],
#                     [   11.,   11.,    11.,    11.,    11.,    11.,    11.,    11.,    11.,11.]])

# weight = np.array([[5000000., 5000000., 11990735., 9000000.],
#                    [       1.,      1.,        0.,       0.],
#                    [       1.,      1.,        1.,       0.],
#                    [       1.,      1.,        1.,       1.]])

# weight = np.array([[10352., 7896.,  7556.,  7406.,  7340.,  7304.,  6876.,  6166.,  5696.],
#                    [   11.,   11.,     0.,     0.,     0.,     0.,     0.,     0.,     0.],
#                    [   11.,   11.,    11.,     0.,     0.,     0.,     0.,     0.,     0.],
#                    [   11.,   11.,    11.,    11.,     0.,     0.,     0.,     0.,     0.],
#                    [   11.,   11.,    11.,    11.,    11.,     0.,     0.,     0.,     0.],
#                    [   11.,   11.,    11.,    11.,    11.,    11.,     0.,     0.,     0.],
#                    [   11.,   11.,    11.,    11.,    11.,    11.,    11.,     0.,     0.],
#                    [   11.,   11.,    11.,    11.,    11.,    11.,    11.,    11.,     0.],
#                    [   11.,   11.,    11.,    11.,    11.,    11.,    11.,    11.,    11.]], dtype='long')

# weight = np.array([[1.0,   3519.0,   3437.0,   3324.0,   3263.0,   3226.0,   3214.0,   3200.0,   3124.0,   2723.0,   2164.0,   1168.0,    275.0,     50.0,      8.0,      0.0,      0.0,      0.0,     0.0,    0.0],
#                    [1.0,    147.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,     0.0,    0.0],
#                    [1.0,    147.0,    147.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,     0.0,    0.0],
#                    [1.0,    154.0,     85.0,     34.0,     18.0,      4.0,      1.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,     0.0,    0.0],
#                    [1.0,    109.0,     92.0,     70.0,     45.0,     26.0,     11.0,      5.0,      1.0,      1.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,     0.0,    0.0],
#                    [1.0,    139.0,    112.0,     69.0,     29.0,      9.0,      1.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,     0.0,    0.0],
#                    [1.0,  23100.0,  23046.0,  22982.0,  22916.0,  22858.0,  22775.0,  22457.0,  21498.0,  19346.0,  14038.0,   6870.0,   1853.0,    377.0,    113.0,     51.0,     29.0,      9.0,     2.0,    0.0],
#                    [1.0,   6316.0,   6237.0,   6021.0,   5525.0,   4528.0,   3199.0,   1793.0,    778.0,    207.0,     25.0,      2.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,     0.0,    0.0],
#                    [1.0,    179.0,    179.0,    179.0,    179.0,    179.0,    179.0,    179.0,    179.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,     0.0,    0.0],
#                    [1.0,    493.0,    493.0,    493.0,    493.0,    493.0,    493.0,    493.0,    493.0,    493.0,      1.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,     0.0,    0.0],
#                    [1.0,    437.0,    437.0,    437.0,    437.0,    437.0,    437.0,    437.0,    437.0,    437.0,    437.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,     0.0,    0.0],
#                    [1.0,    201.0,    201.0,    201.0,    201.0,    201.0,    201.0,    201.0,    201.0,    201.0,    201.0,    201.0,      0.0,      0.0,      0.0,      0.0,      0.0,      0.0,     0.0,    0.0],
#                    [1.0,     33.0,     33.0,     33.0,     33.0,     33.0,     33.0,     33.0,     33.0,     33.0,     33.0,     33.0,     33.0,     33.0,     33.0,     33.0,     33.0,     33.0,     0.0,    0.0],
#                    [1.0,     47.0,     47.0,     47.0,     47.0,     47.0,     47.0,     47.0,     47.0,     47.0,     47.0,     47.0,     47.0,     47.0,      0.0,      0.0,      0.0,      0.0,     0.0,    0.0],
#                    [1.0,  47718.0,  47606.0,  47456.0,  47388.0,  47356.0,  47258.0,  46626.0,  43636.0,  34662.0,  23424.0,  15008.0,   9564.0,   4578.0,   1484.0,    478.0,    214.0,     48.0,     8.0,    0.0],
#                    [1.0,     49.0,     49.0,     49.0,     49.0,     49.0,     49.0,     49.0,     49.0,     49.0,     49.0,     49.0,     49.0,     49.0,     49.0,     49.0,      0.0,      0.0,     0.0,    0.0],
#                    [1.0,     13.0,     13.0,     13.0,     13.0,     13.0,     13.0,     13.0,     13.0,     13.0,     13.0,     13.0,     13.0,     13.0,     13.0,     13.0,     13.0,      0.0,     0.0,    0.0],
#                    [1.0,  12026.0,  12000.0,  11974.0,  11960.0,  11952.0,  11950.0,  11938.0,  11924.0,  11882.0,  11746.0,  11476.0,  11282.0,  11102.0,  10916.0,  10692.0,  10472.0,  10100.0,  8298.0,  658.0],
#                    [1.0,   3664.0,   3664.0,   3662.0,   3654.0,   3652.0,   3648.0,   3628.0,   3580.0,   3408.0,   3088.0,   2660.0,   2254.0,   1946.0,   1608.0,   1236.0,    916.0,    730.0,   428.0,   32.0],
#                    [1.0,   4222.0,   4132.0,   4064.0,   4004.0,   3984.0,   3974.0,   3962.0,   3950.0,   3916.0,   3848.0,   3804.0,   3748.0,   3660.0,   3606.0,   3534.0,   3456.0,   3232.0,  2296.0,  264.0]])
